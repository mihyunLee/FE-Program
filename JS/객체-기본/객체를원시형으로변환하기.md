# 객체를 원시형으로 변환하기



> 출처 - [**모던 JS 튜토리얼**](https://ko.javascript.info/)을 보고 정리한 글입니다.



<br>



객체를 더하거나 빼는 연산을 하거나, 출력을 할 때 객체는 원시값으로 자동 형 변환이 일어난 후 연산이 수행된다.

1. 객체는 논리 평가 시 `true`를 반환하고, 숫자형이나 문자형으로만 형 변환이 일어난다.
2. 숫자형으로의 형 변환은 객체끼리 수학 관련 연산을 할 때 일어난다.
3. 문자형으로의 형 변환은 대개 `alert(obj)` 같이 객체를 출력하려고 할 때 일어난다.

<br>

## 1. ToPrimitive

객체 형 변환은 세 종류로 구분되는데 `hint`라 불리는 값이 구분 기준이 된다.

`hint`란 목표로 하는 자료형 정도로 이해하면 된다.

| hint    | Ex.                                                          |
| ------- | ------------------------------------------------------------ |
| string  | `alert`, `객체 - 문자형` 변환                                  |
| number  | 수학 연산, `객체 - 숫자형` 변환                                |
| default | 변환할 자료형이 확실치 않을 때, `객체 - 문자형`이나 `객체 - 숫자형`과의 동등 비교(`==`) |

<br>

자바스크립트는 형 변환이 필요할 때, 아래의 알고리즘에 따라 원하는 메서드를 찾고 호출한다.

1. 객체에 `obj[Symbol.toPrimitive](hint)`메서드가 있는지 찾고, 있다면 메서드를 호출한다.
    - `Symbol.toPrimitive`는 시스템 심볼로, 심볼형 키로 사용된다.
2. 1에 해당하지 않고 hint가 `string`이라면,
   - `obj.toString()`이나 `obj.valueOf()`를 호출한다.(존재하는 메서드만 실행됨).
3. 1과 2에 해당하지 않고, hint가 `number`나 `default`라면,
   - `obj.valueOf()`나 `obj.toString()`을 호출한다.(존재하는 메서드만 실행됨).

<br>

## 2. Symbol.toPrimitive

- `Symbol.toPrimitive`
  - hint를 명명하는 데 사용되는 내장 심볼
  - 원시값을 반환하지 않을 경우 에러가 발생한다.

```javascript
obj[Symbol.toPrimitive] = function(hint) {
  // 반드시 원시값을 반환해야 함
  // hint는 "string", "number", "default" 중 하나가 될 수 있다.
};
```

### Ex.

```javascript
let user = {
  name: "John",
  money: 1000,

  [Symbol.toPrimitive](hint) {
    alert(`hint: ${hint}`);
    return hint == "string" ? `{name: "${this.name}"}` : this.money;
  }
};

alert(user); // hint: string -> {name: "John"}
alert(+user); // hint: number -> 1000
alert(user + 500); // hint: default -> 1500
```



## 3. toString과 valueOf

`toString`과 `valueOf`는 심볼이 생기기 이전부터 존재해왔던 형 변환을 구현할 수 있는 메서드이다.

객체에 `Symbol.toPrimitive`가 없으면 자바스크립트는 `toString`이나 `valueOf`를 호출한다.

| hint     | 호출 순서               |
| -------- | ----------------------- |
| `string` | `toString` -> `valueOf` |
| 그 외    | `valueOf` -> `toString` |

호출 순서는 예를 들어 `toString`이 있다면 `toString`을 호출하고, 없다면 `valueOf`를 호출한다.

이 메서드들은 반드시 원시값을 반환하고, 객체를 반환하게 되면 그 결과는 무시된다.

또한 `Symbol.toPrimitive`와는 다르게 객체를 반환할 경우 에러가 일어나지는 않는다.

| 메서드   | 반환 값                    |
| -------- | -------------------------- |
| toString | 문자열 `"[object object]"` |
| valueOf  | 객체 자신을 반환           |

```javascript
let user = {name: "John"};

alert(user); // [object Object]
alert(user.valueOf() === user); // true
```



`toString`과 `valueOf`를 조합해서 만들면 `Symbol.toPrimitive`와 동일하게 동작한다.

```javascript
let user = {
  name: "John",
  money: 1000,

  // hint가 "string"인 경우
  toString() {
    return `{name: "${this.name}"}`;
  },

  // hint가 "number"나 "default"인 경우
  valueOf() {
    return this.money;
  }

};

alert(user); // toString -> {name: "John"}
alert(+user); // valueOf -> 1000
alert(user + 500); // valueOf -> 1500
```

<br>

## 4. 반환 타입

`toString`, `valueOf`, `Symbol.roPrimitive` 세 개의 메서드는 hint에 명시된 자료형으로의 형 변환을 보장해주지 않는다.

객체가 아닌 원시값을 반환해준다는 것 뿐이다.

<br>

## 5. 추가 형 변환

객체가 피연산자일 때는 형 변환이 여러 차례로 일어날 수 있다.

1. 객체는 원시형으로 변환된다.
2. 변환 후 원시값이 원하는 형이 아닐 경우 다시 형 변환이 일어난다.

- Ex. 곱셈 연산자 `*`

```javascript
let obj = {
  // 다른 메서드가 없으면 toString에서 모든 형 변환을 처리한다.
  toString() {
    return "2";
  }
};

alert(obj * 2); // 4, 객체가 문자열 "2"로 바뀌고, 곱셈 연산 과정에서 문자열 "2"는 숫자 2로 변경된다.
```

- Ex. 이항 덧셈 연산자 `+`

```javascript
let obj = {
  toString() {
    return "2";
  }
};

alert(obj + 2); // 22, obj는 문자열이 반환되기 때문에 문자열끼리의 병합이 일어난다.
```

